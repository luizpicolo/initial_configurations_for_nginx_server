server {
        listen   443 ssl http2; ## if your nginx supported http2, if not just remove http2 word
        #listen   [::]:80 default ipv6only=on; ## listen for ipv6

    	root /home/your_domain/public_html/railsapp/current/public;
     	index index.php index.html;
    	server_name your_domain.com www.your_domain.com;

    	##
    	# SSL Configuration
    	##

		ssl_certificate /etc/letsencrypt/live/your_domain.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/your_domain.com/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/your_domain.com/chain.pem;

		ssl_session_cache shared:SSL:20m;
        ssl_session_timeout 60m;
 		ssl_prefer_server_ciphers on;
 		ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
 		ssl_stapling on;
        ssl_stapling_verify on;
        ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;
		resolver 8.8.8.8 8.8.4.4;
        ssl_dhparam /etc/nginx/dhparams.pem;  #generate dhparam = https://weakdh.org/sysadmin.html

        add_header Strict-Transport-Security "max-age=31536000; always";

        ##
        # PageSpeed Settings (install it on https://www.modpagespeed.com/doc/build_ngx_pagespeed_from_source)
        # PageSpeed can optimize your site
        # comment below if you aren't install it yet
        ##

        pagespeed on;
        pagespeed XHeaderValue "Google PageSpeed";
        # Needs to exist and be writable by nginx.  Use tmpfs for best performance.
        pagespeed FileCachePath /var/ngx_pagespeed_cache;

        # Ensure requests for pagespeed optimized resources go to the pagespeed handler
        # and no extraneous headers get set.
        
        location ~ "\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+" {
         add_header "" "";
        }
        location ~ "^/pagespeed_static/" { }
        location ~ "^/ngx_pagespeed_beacon$" { }
        
        ##
        # Passenger
        ## 
        
  		passenger_enabled on;
  		rails_env production;
  		passenger_ruby /home/your_domain/.rvm/gems/ruby-2.3.1/wrappers/ruby;

}

server {
    listen 80;
    server_name your_domain.com www.your_domain.com;
    rewrite ^ https://www.your_domain.com;$request_uri permanent; #redirect to HTTPS
}

